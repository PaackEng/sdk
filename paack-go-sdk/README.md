# Paack Go SDK

More can be found [here](https://paacklogistics.atlassian.net/wiki/spaces/CS/pages/3294330961/Standard+integration+speed-up+SDKs)

### Supported Go Versions

This library supports the following Go implementations:

* Go 1.15
* Go 1.16
* Go 1.17
* Go 1.18
* Go 1.19

## Installation

To use paack-go-sdk in your project initialize go modules then run:

```bash
go get github.com/PaackEng/paack-go-sdk
```

## Getting Started

Getting started with the Paack API couldn't be easier. Create a `NewPaack` and you're ready to go.

### API Credentials

When constructing the Paack object to utilize the SDK you must pass your Paack credentials via the constructor. The credentials (clientId and clientSecret) must match the environment you plan to use the SDK with. Using the “domain” argument you must specify either the Staging or Production environment.

### Authentication

The SDK handles the authentication with Paack APIs automatically. You don’t need to worry about it.
Using the credentials provided it will generate a token with the required audience for each API you plan to use. The token is generated lazy, when you first call that API.
Once the token was generated, it will cache it for future use. Every time you call an API using the SDK methods, it will automatically be added in the headers of the request.
In case the API request will respond that the token is expired, the SDK will automatically refresh the token and re-send the request using the new token.

### Configuration

The SDK uses 2 sources of configuration values: locally from the SDK, remote from Paack servers.
When the Paack object is initialized, it will first use the local configuration. This helps the SDK know where to connect for authentication and retrieving the remote configuration as well as serve as a baseline for configuration values.

Once the local configuration is loaded successfully, it will retrieve additional configuration values from Paack servers. Once retrieved, they are merged with the local configuration properties. This allows Paack to do over-the-air updates to certain parts of the SDK without requiring you to update the version of the SDK. It also enables us to tailor the behavior of certain SDK methods to better fit your use-cases.

### Caching

To cache values when needed, we are using an in-memory Map that is thread-safe and has an expiry policy.
For Authentication tokens, the expiry is based on the expiry time of each token minus 5 minutes.
The offset of 5 minutes is preventing edge-cases when the token is going to expire after it was sent to Paack servers.
The ‘CacheCleanupHoursInterva’l variable indicates the number of hours after which all expired tokens will be deleted from the cache.

### Logging

customLogger can be replaced with any logger. The only requirement is that the logger implements the functions of the logger.Logger interface.

```go
package main


import (
	"fmt"
	"github.com/PaackEng/paack-go-sdk"
	"github.com/PaackEng/paack-go-sdk/resources"
	log "github.com/sirupsen/logrus"
	"os"
)

func main() {
	clientId := os.Getenv("CLIENT_ID")
	clientSecret := os.Getenv("CLIENT_SECRET")

	if clientSecret == "" || clientId == "" {
		fmt.Println("No credentials found")
		return
	}

	/*
		type Logger interface {
			Debug(args ...interface{})
			Info(args ...interface{})
			Error(args ...interface{})
		}
	*/
	customLogger := log.WithFields(log.Fields{
		"service": "paack-sdk",
	})

	paackClient, err := paack_go_sdk.NewPaack(clientId, clientSecret, resources.Domain, customLogger)
	if err != nil {
		return
	}
}
```

### Create a new Order with Warehouse Model
```go
var order = types.Order{...}
labelFormat := "pdf"
apiResponse, err := p.Order.CreateWithStore(order, &labelFormat)
```

### Query an Order by ID
```go
apiResponse, err = p.Order.GetById(order.ExternalID, nil)
```

### Create and return a label for an order
```go
var request = rest.LabelCreateRequest{...}

apiResponse, err = p.Label.LabelCreate(request, resources.PdfLabel)
```

### Retrieve the last status of the order with the specified ID
```go
apiResponse, err = p.TrackingPull.OrderStatusGet(order.ExternalID)
```

### Validations

When using the SDK, we are validating the models / structures provided as input. This validation happens locally, before making the API request to Paack servers. It checks for “constraints” of the properties that are universally valid and are not expected to evolve without breaking changes of the API. It is not validating the correctness of the value in a given business context as this might evolve in time and depending on your use-case.

When a validation fails, the provided response is in the same structures as the response of the API in case of an error. The goal is to make the handling of such errors seamless.


All errors generated by the functions have the following structure:
```go
type ErrorResponse struct {
    Data     []Data           `json:"data"`
    Error    []Error          `json:"error"`
    Meta     interface{}      `json:"meta,omitempty"`
    Included []Data           `json:"included,omitempty"`
    Links    *map[string]Link `json:"links"`
}

type Error struct {
    ID     string `json:"id,omitempty"`
    Status string `json:"status,omitempty"`
    Source string `json:"source,omitempty"`
    Code   string `json:"code,omitempty"`
    Detail string `json:"detail,omitempty"`
}

type Data struct {
    Type       string      `json:"type,omitempty"`
    ID         string      `json:"id,omitempty"`
    Attributes interface{} `json:"attributes,omitempty"`
}

type Link struct {
    Href string      `json:"href,omitempty"`
    Meta interface{} `json:"meta,omitempty"`
}
```

Error codes:

* 001 - the field is empty but it is required
* 002 - the provided value in the field has an invalid size. Either too small or too large.
* 003 - the field does not correspond to the regex pattern or does not belong to the expected list of values.

